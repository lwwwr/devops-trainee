#sudo gem install getoptlong
#not work correctly with destroy
#TBD
require 'getoptlong'

script = <<-SCRIPT
    sudo yum install nano  git -y
    SCRIPT

template = {
    hostname: "centos-host",
    box: "doesitblend/centos7"  #"debian/jessie64"
  }

opts = GetoptLong.new(
  [ '--hosts-number', GetoptLong::OPTIONAL_ARGUMENT ]
)

custom_parameter=''

opts.each do |opt, arg|
  case opt
  when '--hosts-number'
    custom_parameter=arg
  end
end

raise ArgumentError, 'Wrong number format' unless custom_parameter.scan(/[^0-9]/).empty?
custom_parameter = custom_parameter.to_i == 0 ? 1 : custom_parameter.to_i

Vagrant.configure("2") do |config|
  (1..custom_parameter).each do |i|
    config.vm.define "some-#{template[:hostname]}-#{i}" do |node|
      node.vm.box = template[:box]
      node.vm.hostname = "ololo-some-#{template[:hostname]}-#{i}"
      node.vm.network "private_network", ip: "192.168.50.#{i}"
      ENV['LC_ALL']="en_US.UTF-8"
      node.vm.provision :hosts, sync_hosts: true
      node.vm.provision :shell, inline: script
    end
  end
end



